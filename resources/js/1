document.addEventListener("DOMContentLoaded", () => {
    const resultNode = document.querySelector(".result")
    resultNode.style.display = "none"

    function formError(target, message) {
        const resultNode = target.querySelector(".result")
        const messageNode = resultNode.querySelector(".message")

        messageNode.replaceChildren(document.createTextNode(message))

        resultNode.style.display = "flex"
        resultNode.style.opacity = "0"

        requestAnimationFrame(() => {
            setTimeout(() => {
                resultNode.setAttribute("data-visible", "true")
                resultNode.setAttribute("data-status", "error")

                resultNode.style.opacity = "1"
            })
        })

        // setTimeout(() => resultNode.style.display = "none", 5000)
        setTimeout(() => resultNode.style.opacity = "0", 5000)

        setTimeout(() => {
            resultNode.style.display = "none"

            resultNode.removeAttribute("data-status")
            resultNode.removeAttribute("data-visible")
        }, 5000 + 200)
    }

    document.addEventListener("submit", async e => {
        e.preventDefault()

        const body = new FormData(e.target)
        body.append("ajax", true)

        const result = await fetch(e.target.action, {
            method: "POST",
            body,
        })

        try {
            JSON.parse(result)
        } catch (error) {
            formError(e.target, "Что-то пошло не так, попробуйте позже")
        }


    })
})
